"use strict";(self["webpackChunkibookingsystem_vue"]=self["webpackChunkibookingsystem_vue"]||[]).push([[405],{8405:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var r=function(){var t=this,e=t._self._c;return e("div",[t._l(parseInt(t.seatData.length/12+1),(function(a){return e("div",{key:a},[e("el-row",{attrs:{gutter:20}},t._l(t.seatData.slice(12*(a-1),12*(a-1)+12),(function(a,r){return e("el-col",{key:r,attrs:{span:2}},[e("el-button",{attrs:{type:a.is_used?"danger":"success",disabled:a.is_used,id:a.id},on:{click:function(e){return t.getCurSeatData(a.id)}}},[t._v(t._s(a.name))]),e("el-row",{staticStyle:{"text-align":"center"}},[e("span",[a.is_special?e("i",{staticClass:"el-icon-switch-button"}):t._e(),t._v(" "+t._s(a.is_special?"有插座":"无插座")+" ")])])],1)})),1)],1)})),e("div",[e("el-dialog",{attrs:{visible:t.dialogVisible,title:"座位信息",width:"400px"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.clearForm}},[e("el-form",{ref:"form",attrs:{model:t.curSeatData,"label-width":"80px"}},[e("p",{staticStyle:{"text-align":"center"}},[e("b",[t._v(t._s("座位名称:"+t.curSeatData.name))])]),e("el-form-item",{attrs:{label:"预约时间"}},[e("el-select",{attrs:{placeholder:"起始时间",id:"start_time"},model:{value:t.curSeatData.start_time,callback:function(e){t.$set(t.curSeatData,"start_time",e)},expression:"curSeatData.start_time"}},t._l(t.st_list,(function(t){return e("el-option",{key:t,attrs:{value:t,id:"start_opt"}})})),1),e("el-select",{attrs:{placeholder:"结束时间",id:"end_time"},model:{value:t.curSeatData.end_time,callback:function(e){t.$set(t.curSeatData,"end_time",e)},expression:"curSeatData.end_time"}},t._l(t.et_list,(function(t){return e("el-option",{key:t,attrs:{value:t,id:"end_opt"}})})),1)],1)],1),e("span",{attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary",id:"booking"},on:{click:t.submitOrderInfo}},[t._v("预约")]),e("el-button",{on:{click:t.clearForm}},[t._v("取消")])],1)],1)],1)],2)},s=[],i=(a(7658),a(4986)),n={data(){return{seatData:[],currentIndex:-1,cid:"",uid:"",dialogVisible:!1,curSeatData:{},classroom_start_time:-1,classroom_end_time:-1,st_list:[],et_list:[]}},methods:{padZero(t){return t.toString().padStart(2,"0")},numToDate(t){var e=new Date,a=e.getFullYear(),r=e.getMonth()+1,s=e.getDate(),i=a+"-"+this.padZero(r)+"-"+this.padZero(s)+" "+t;return i},dateToNum(t){var e=t.split(" ")[1].split(":")[0];return e},submitOrderInfo(){console.log(this.curSeatData),console.log(this.numToDate(this.curSeatData.start_time)),(0,i.pm)(this.uid,this.curSeatData.id,this.numToDate(this.curSeatData.start_time),this.numToDate(this.curSeatData.end_time)).then((t=>{1===t.data.results.preserve?(this.$message("预约成功！"),this.clearForm()):this.$message("预约失败！")}))},getCurSeatData(t){this.dialogVisible=!0,(0,i.D)(t).then((t=>{this.curSeatData=t.data.results,console.log(t,this.dateToNum(this.curSeatData.pre_list[0].start_time),this.dateToNum(this.curSeatData.pre_list[0].end_time)),this.st_list=[];for(let e=this.classroom_start_time;e<this.classroom_end_time;e++)this.st_list.push(this.convertToTime(e));for(let e=0;e<this.curSeatData.pre_list.length;e++){let t=parseInt(this.dateToNum(this.curSeatData.pre_list[e].start_time)),a=parseInt(this.dateToNum(this.curSeatData.pre_list[e].end_time));for(let e=t;e<a;e++){let t=this.st_list.indexOf(this.convertToTime(e));this.st_list.splice(t,1)}}}))},convertToTime(t){var e=String(t);e.length<2&&(e="0"+e);var a=e+":00";return a},convertToNumber(t){if(t){var e=Number(t.replace(":",""))/100;return e}return 0},clearForm(){this.curSeatData.start_time="",this.curSeatData.end_time="",this.dialogVisible=!1}},watch:{"curSeatData.start_time":function(t){this.et_list=[];let e=[];for(let r=this.classroom_start_time;r<=this.classroom_end_time;r++)e.push(r);for(let r=0;r<this.curSeatData.pre_list.length;r++){let t=parseInt(this.dateToNum(this.curSeatData.pre_list[r].start_time)),a=parseInt(this.dateToNum(this.curSeatData.pre_list[r].end_time));for(let r=t+1;r<=a;r++){let t=e.indexOf(r);e.splice(t,1)}}let a=this.convertToNumber(t);for(let r=0;r<e.length;r++)if(e[r]-1==a)for(let t=r;t<r+4;t++)e[t]-a==t-r+1&&this.et_list.push(this.convertToTime(e[t]))}},created(){this.cid=this.$route.params.cid,this.uid=this.$route.params.uid,(0,i.V3)(this.cid).then((t=>{this.seatData=t.data.results,this.classroom_start_time=t.data.start_time,this.classroom_end_time=t.data.end_time}))}},o=n,l=a(1001),u=(0,l.Z)(o,r,s,!1,null,null,null),c=u.exports},4986:function(t,e,a){a.d(e,{BY:function(){return s},D:function(){return o},Lr:function(){return d},V3:function(){return n},eO:function(){return i},jc:function(){return c},pm:function(){return u},sz:function(){return l}});var r=a(960);function s(){return(0,r.W)({method:"get",url:"/classrooms/overview"})}function i(t,e,a){let s=new URLSearchParams;return s.append("cid",t),s.append("start_time",e),s.append("end_time",a),(0,r.W)({method:"post",url:"/classrooms/modify_time",data:s})}function n(t){return(0,r.W)({method:"get",url:"/classrooms/detail/?cid="+t})}function o(t){return(0,r.W)({method:"get",url:"/seats/detail/?sid="+t})}function l(t){return(0,r.W)({method:"get",url:"/students/detail/?uid="+t})}function u(t,e,a,s){let i=new URLSearchParams;return i.append("uid",t),i.append("sid",e),i.append("start_time",a),i.append("end_time",s),(0,r.W)({method:"post",url:"/students/preserve",data:i})}function c(t){let e=new URLSearchParams;return e.append("pid",t),(0,r.W)({method:"post",url:"/preserve/check_in",data:e})}function d(t){let e=new URLSearchParams;return e.append("pid",t),(0,r.W)({method:"post",url:"/preserve/cancel",data:e})}}}]);
//# sourceMappingURL=405.6d09669c.js.map