"use strict";(self["webpackChunkibookingsystem_vue"]=self["webpackChunkibookingsystem_vue"]||[]).push([[698],{9448:function(t,e,a){a.r(e),a.d(e,{default:function(){return c}});var n=function(){var t=this,e=t._self._c;return e("div",[e("el-descriptions",{staticClass:"margin-top",attrs:{title:"个人信息",column:2,size:t.size,border:""}},[e("template",{slot:"extra"},[e("el-button",{attrs:{type:"primary",size:"small"}},[t._v("操作")])],1),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-s-promotion"}),t._v(" 邮箱 ")]),t._v(" "+t._s(t.email)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-user-solid"}),t._v(" 用户名 ")]),t._v(" "+t._s(t.name)+" ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-star-on"}),t._v(" 密码 ")]),t._v(" ******* ")],2),e("el-descriptions-item",[e("template",{slot:"label"},[e("i",{staticClass:"el-icon-s-home"}),t._v(" 是否违规 ")]),t._v(" "+t._s("1"==t.violate?"是":"否")+" ")],2)],2),e("el-table",{attrs:{data:t.appointments,border:""}},[e("el-table-column",{attrs:{prop:"c_name",label:"自习室名称"}}),e("el-table-column",{attrs:{prop:"s_name",label:"座位名称"}}),e("el-table-column",{attrs:{prop:"start_time",label:"开始时间"}}),e("el-table-column",{attrs:{prop:"end_time",label:"结束时间"}}),e("el-table-column",{attrs:{label:"倒计时"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(t.getRemainingTime(a.row)))])]}}])}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"primary",size:"small",disabled:!!a.row.is_check_in},on:{click:function(e){return t.signIn(a.row)}}},[t._v("签到")])]}}])}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.cancelSignIn(a.row)}}},[t._v("取消")])]}}])})],1)],1)},s=[],i=a(4986),r={data(){return{size:"medium",uid:0,name:"",email:"",password:"",violate:"",appointments:[],canSignIn:!1}},mounted(){(0,i.sz)(this.$route.params.id).then((t=>{console.log(this.$route.params.id),console.log(t),this.uid=t.data.results.id,this.name=t.data.results.name,this.email=t.data.results.email,this.appointments=t.data.results.pre_list,this.violate=t.data.results.violate,this.startCountdown()}))},methods:{calculateDistance(t,e,a,n){const s=6371e3,i=t=>t*(Math.PI/180),r=i(a-t),l=i(n-e),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(i(t))*Math.cos(i(a))*Math.sin(l/2)*Math.sin(l/2),u=2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)),c=s*u;return c},cancelSignIn(t){(0,i.Lr)(t.pid).then((t=>{t.data.results.isCancel?(alert("取消成功！"),(0,i.sz)(this.$route.params.id).then((t=>{console.log(this.$route.params.id),console.log(t),this.uid=t.data.results.id,this.name=t.data.results.name,this.email=t.data.results.email,this.appointments=t.data.results.pre_list}))):alert("取消失败！")}))},signIn(t){console.log(t),(0,i.jc)(t.pid).then((t=>{t.data.results.isSignUp?(alert("签到成功"),(0,i.sz)(this.$route.params.id).then((t=>{console.log(this.$route.params.id),console.log(t),this.uid=t.data.results.id,this.name=t.data.results.name,this.email=t.data.results.email,this.appointments=t.data.results.pre_list}))):alert("签到失败")}))},successCallback(t,e){const a=31.3347,n=121.4165,s=t.coords.latitude,r=t.coords.longitude;console.log(s,r);let l=this.calculateDistance(s,r,a,n);console.log(l),this.canSignIn=0!=l,this.canSignIn?(console.log(e),(0,i.jc)(e.pid).then((t=>{t.data.results.isSignUp?(alert("签到成功"),(0,i.sz)(this.$route.params.id).then((t=>{console.log(this.$route.params.id),console.log(t),this.uid=t.data.results.id,this.name=t.data.results.name,this.email=t.data.results.email,this.appointments=t.data.results.pre_list}))):alert("签到失败")}))):alert("不在签到范围内！")},errorCallback(t){switch(t.code){case t.PERMISSION_DENIED:alert("用户拒绝地理位置定位请求");break;case t.POSITION_UNAVAILABLE:alert("无法获取当前位置信息");break;case t.TIMEOUT:alert("获取位置信息超时");break;case t.UNKNOWN_ERROR:alert("发生未知错误");break}},startCountdown(){this.appointments.forEach((t=>{const e=()=>{const e=new Date(t.start_time).getTime(),a=(new Date).getTime(),n=e-a;t.remainingTime=n>0?n:0,n<=0&&(clearInterval(t.countdownIntervalId),t.remainingTime=0)};e(),t.countdownIntervalId||(t.countdownIntervalId=setInterval(e,1e3))}))},stopCountdown(t){clearInterval(t.countdownIntervalId),t.countdownIntervalId=null,t.remainingTime=0},getRemainingTime(t){if(null!==t.remainingTime){const e=Math.floor(t.remainingTime/36e5),a=Math.floor(t.remainingTime%36e5/6e4),n=Math.floor(t.remainingTime%6e4/1e3);return`${e.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`}return""}},beforeDestroy(){null!=this.appointments&&this.appointments.forEach((t=>{clearInterval(t.countdownIntervalId)}))}},l=r,o=a(1001),u=(0,o.Z)(l,n,s,!1,null,null,null),c=u.exports},4986:function(t,e,a){a.d(e,{BY:function(){return s},D:function(){return l},Lr:function(){return d},V3:function(){return r},eO:function(){return i},jc:function(){return c},pm:function(){return u},sz:function(){return o}});var n=a(960);function s(){return(0,n.W)({method:"get",url:"/classrooms/overview"})}function i(t,e,a){let s=new URLSearchParams;return s.append("cid",t),s.append("start_time",e),s.append("end_time",a),(0,n.W)({method:"post",url:"/classrooms/modify_time",data:s})}function r(t){return(0,n.W)({method:"get",url:"/classrooms/detail/?cid="+t})}function l(t){return(0,n.W)({method:"get",url:"/seats/detail/?sid="+t})}function o(t){return(0,n.W)({method:"get",url:"/students/detail/?uid="+t})}function u(t,e,a,s){let i=new URLSearchParams;return i.append("uid",t),i.append("sid",e),i.append("start_time",a),i.append("end_time",s),(0,n.W)({method:"post",url:"/students/preserve",data:i})}function c(t){let e=new URLSearchParams;return e.append("pid",t),(0,n.W)({method:"post",url:"/preserve/check_in",data:e})}function d(t){let e=new URLSearchParams;return e.append("pid",t),(0,n.W)({method:"post",url:"/preserve/cancel",data:e})}}}]);
//# sourceMappingURL=698.30c29254.js.map